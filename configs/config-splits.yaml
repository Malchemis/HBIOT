# ----------------------------------------
# MEG Cross-Validation Split Generation Configuration
# ----------------------------------------

# Base directory configuration
# ---------------------------
# Paths to source data and output directories (same as main config)
root_dirs: 
  - "${root_dir}"

# Cross-validation configuration
# -----------------------------
n_splits: 5                     # Number of K-fold splits to generate
random_state: 42                # Random seed for reproducible splits
splits_output_dir: "${data_dir}/cv_splits"  # Directory to save split files

# Logging configuration
# -------------------
log_level: "INFO"               # Logging level
log_file: "${log_dir}/generate_splits.log"  # Log file path

# Annotation rules (same as main config)
# -------------------------------------
annotation_rules:
  # Holdout patients group annotation rules (test set)
  Holdout:
    include: ["jj_add", "JJ_add", "jj_valid", "JJ_valid"]
    exclude: []

  # IterativeLearningFeedback1 group annotation rules
  IterativeLearningFeedback1:
    include: []
    exclude: ["detected_spike", "bad_1"]

  # IterativeLearningFeedback2 group annotation rules
  IterativeLearningFeedback2:
    include: []
    exclude: ["detected_spike", "bad_1"]

  # MEG group annotation rules
  MEG:
    include: ["event"]
    exclude: []
  
  # Omega dataset group annotation rules (control data)
  Omega:
    include: ["aaa"]  # No valid annotations
    exclude: []

  # Default rules for other groups
  Default:
    include: []
    exclude: ["true_spike", "detected_spike", "bad_1"]

# Per-spike quality filtering
# ------------------------------------------
# Reject individual spikes that do not show activity in enough channels.
# Requires loading MEG data and computing peak-to-peak amplitude z-scores.
spike_quality_filtering:
  enabled: true
  threshold_zscore: 2.5           # Z-score threshold for active channel detection
  min_active_channels: 5          # Minimum channels with activity to keep a spike
  epoch_half_duration_s: 0.05     # Half-window around spike peak for PTP calculation

# Signal processing applied before spike quality filtering
# ------------------------------------------
# Must match the main config (default_config.yaml) to ensure consistent
# spike quality filtering between split generation and HDF5 caching.
preprocessing:
  sampling_rate: 200              # Target sampling rate (Hz)
  l_freq: 1.0                    # High-pass filter cutoff (Hz)
  h_freq: 99.0                   # Low-pass filter cutoff (Hz)
  notch_freq: 50.0               # Notch filter for line noise (Hz)

# Subject-level filtering
# ------------------------------------------
# Remove subjects with suspiciously low spike rates from train/val pool.
# Subjects with 0 spikes (controls) are always kept.
subject_filtering:
  enabled: true
  min_spikes_per_minute: 0.5      # Subjects with 0 < rate < this are removed
  protect_groups:                  # Groups never filtered (e.g., test/holdout)
    - "Holdout"

# Files to skip
# ------------------------------------------
skip_files:
  - ".*brana_Epi-001_20100420_05.*"
  - ".*P283/p1.*"
  - ".*P30/p4.*"